generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Simulation {
  id          String   @id @default(cuid())
  slug        String   @unique
  title       String
  category    String
  description String
  viewCount   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  sessions SimulationSession[]

  @@index([category])
}

model SimulationSession {
  id           String   @id @default(cuid())
  simulationId String
  simulation   Simulation @relation(fields: [simulationId], references: [id])
  startedAt    DateTime @default(now())
  endedAt      DateTime?
  duration     Int?     // seconds
  parameters   Json?    // snapshot of params used

  chatMessages ChatMessage[]

  @@index([simulationId])
}

model ChatMessage {
  id        String   @id @default(cuid())
  sessionId String
  session   SimulationSession @relation(fields: [sessionId], references: [id])
  role      String   // "user" | "assistant"
  content   String
  createdAt DateTime @default(now())

  @@index([sessionId])
}
